См. комментарии к изначальной версии кода в предыдущем коммите
